<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Version: 1.5.0 (2024-08-15) 
         Changes: 
        - 월령 낮잠 횟수별 지속시간 미세조정
        - 깨어 있는 시간 증가폭 수정
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마리드 유아 일정</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
    html {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
        height: auto;
        font-family: 'Gowun Dodum', sans-serif;
        background-color: #fdfdfd;
        color: #6B5344;
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
    }
    .header, .input-section, .schedule-section {
        width: 100%;
        max-width: 100%;
        padding: 10px;
        box-sizing: border-box;
    }
    .content-wrapper {
        width: 100%;
        max-width: 100%;
        padding: 10px;
        box-sizing: border-box;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    @media (min-width: 600px) {
        .content-wrapper {
            max-width: 90%;
        }
    }
    @media (min-width: 900px) {
        .content-wrapper {
            max-width: 800px;
        }
    }
    h1, h2 {
        color: #69BCC9;
        font-size: 1.5em;
        font-family: 'Gowun Dodum', sans-serif;
    }
    .input-section, .schedule-section {
        background-color: #FFFFFF;
        box-shadow: 0 4px 8px rgba(105, 188, 201, 0.2);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
    }
    button {
        background-color: #FFB6C1;
        color: #FFFFFF;
        border-radius: 25px;
        font-size: 16px;
        transition: all 0.3s ease;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        width: 100%;
        max-width: 200px;
    }
    button:hover {
        background-color: #FFA0B0;
        transform: scale(1.05);
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }
    th, td {
        padding: 8px 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: #69BCC9;
        color: #FFFFFF;
    }
    tr:nth-child(even) {
        background-color: #F0F8FA;
    }
    input, select {
        border: 2px solid #FFB6C1;
        border-radius: 10px;
        padding: 8px;
        font-size: 14px;
        width: 100%;
        max-width: 200px;
    }
    .logo {
        max-width: 200px;
        margin-bottom: 20px;
    }
    #errorMessage {
        color: red;
        margin-top: 10px;
        font-weight: bold;
        font-size: 14px;
    }
    .input-group {
        margin-bottom: 15px;
    }
    .input-group label {
        display: block;
        margin-bottom: 5px;
    }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="header">
            <h1>마리드 일정 계산기</h1>
        </div>
        <div class="input-section">
             <h2>유아 정보 입력</h2>
        <div class="input-group">
            <label for="ageSelect">유아의 나이</label>
            <select id="ageSelect">
                <option value="">개월수 선택</option>
            </select>
        </div>
        <div class="input-group">
            <label for="wakeUpTime">아침 기상 시간</label>
            <input type="time" id="wakeUpTime">
        </div>
        <div class="input-group">
            <label for="awakeTimeHours">기상 후 첫 낮잠까지 깨어있는 시간</label>
            <div>
                <input type="number" id="awakeTimeHours" min="0" max="5" step="1" style="width: 50px;"> 시간
                <input type="number" id="awakeTimeMinutes" min="0" max="59" step="1" style="width: 50px;"> 분
            </div>
        </div>
        <div class="input-group">
            <label for="napCountSelect">낮잠 횟수</label>
            <select id="napCountSelect">
                <option value="">횟수 선택</option>
                <option value="1">1회</option>
                <option value="2">2회</option>
                <option value="3">3회</option>
                <option value="4">4회</option>
            </select>
        </div>
        <div class="input-group">
            <label for="nightSleepDuration">밤잠 지속 시간</label>
            <select id="nightSleepDuration">
                <option value="540">9시간</option>
                <option value="600">10시간</option>
                <option value="660" selected>11시간</option>
                <option value="720">12시간</option>
            </select>
        </div>
        <button id="generateSchedule">일정 생성</button>
    </div>
    <div id="errorMessage" style="display: none;"></div>
    <div class="schedule-section">
        <h2>제안 일정</h2>
        <table id="scheduleTable">
            <thead>
                <tr>
                    <th>시간</th>
                    <th>활동</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // 월령별 제안 일정 데이터 (분 단위로 변경)
        const scheduleData = {
            3: { awakeTime: 70, napCount: 4 },
            4: { awakeTime: 90, napCount: 3 },
            5: { awakeTime: 120, napCount: 3 },
            6: { awakeTime: 120, napCount: 3 },
            7: { awakeTime: 120, napCount: 3 },
            8: { awakeTime: 120, napCount: 3 },
            9: { awakeTime: 150, napCount: 2 },
            10: { awakeTime: 150, napCount: 2 },
            11: { awakeTime: 150, napCount: 2 },
            12: { awakeTime: 180, napCount: 2 },
            13: { awakeTime: 180, napCount: 2 },
            14: { awakeTime: 180, napCount: 1 },
            15: { awakeTime: 180, napCount: 1 },
            16: { awakeTime: 210, napCount: 1 },
            17: { awakeTime: 210, napCount: 1 },
            18: { awakeTime: 240, napCount: 1 },
            19: { awakeTime: 240, napCount: 1 },
            20: { awakeTime: 300, napCount: 1 }
        };

        // 월령과 낮잠 횟수에 따른 낮잠 지속 시간 (분 단위)
        const NAP_DURATIONS_BY_AGE_AND_COUNT = {
            3: { 4: [70, 90, 60, 30], 3: [90, 90, 70] },
            4: { 4: [60, 90, 40, 30], 3: [80, 100, 40] },
            5: { 4: [60, 90, 30, 30], 3: [70, 100, 20] },
            6: { 3: [70, 100, 20] },
            7: { 3: [60, 90, 20], 2: [90, 90] },
            8: { 3: [60, 80, 20], 2: [90, 90] },
            9: { 2: [90, 90] },
            10: { 2: [80, 90] },
            11: { 2: [60, 90], 1: [180] },
            12: { 2: [60, 90], 1: [180] },
            13: { 2: [60, 90], 1: [180] },
            14: { 2: [60, 90], 1: [180] },
            15: { 2: [60, 70], 1: [180] },
            16: { 2: [60, 60], 1: [180] },
            17: { 1: [150] },
            18: { 1: [150] },
            19: { 1: [150] },
            20: { 1: [150] }
        };

        const ageSelect = document.getElementById('ageSelect');
        const wakeUpTimeInput = document.getElementById('wakeUpTime');
        const awakeTimeHoursInput = document.getElementById('awakeTimeHours');
        const awakeTimeMinutesInput = document.getElementById('awakeTimeMinutes');
        const nightSleepDurationSelect = document.getElementById('nightSleepDuration');
        const generateScheduleBtn = document.getElementById('generateSchedule');
        const scheduleTable = document.getElementById('scheduleTable').getElementsByTagName('tbody')[0];
        const errorMessageDiv = document.getElementById('errorMessage');
        const napCountSelect = document.getElementById('napCountSelect');

        // 나이 선택 옵션 생성
        Object.keys(scheduleData).forEach(age => {
            const option = document.createElement('option');
            option.value = age;
            option.textContent = `${age}개월`;
            ageSelect.appendChild(option);
        });

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.style.display = 'block';
        }

        function hideError() {
            errorMessageDiv.style.display = 'none';
        }

        function getNapDuration(age, napCount, napIndex) {
            const ageData = NAP_DURATIONS_BY_AGE_AND_COUNT[age];
            if (!ageData) {
                console.warn(`No data for age ${age}, using default duration.`);
                return 90; // 기본 낮잠 시간 (1.5시간 = 90분)
            }

            const napDurations = ageData[napCount];
            if (!napDurations) {
                console.warn(`No data for ${napCount} naps at age ${age}, using default duration.`);
                return 90; // 기본 낮잠 시간
            }

            return napDurations[napIndex] || 90; // 해당 인덱스의 낮잠 시간이 없으면 기본값 사용
        }

        function getAwakeTimeIncrease(age) {
            if (age < 9) {
                return 10; // 9개월 미만: 10분씩 증가
            } else if (age < 13) {
                return 15; // 9개월 이상 13개월 미만: 15분씩 증가
            } else {
                return 20; // 13개월 이상: 20분씩 증가
            }
        }

        function minutesToTimeString(totalMinutes) {
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        function timeStringToMinutes(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function generateSchedule() {
            hideError();

            const age = parseInt(ageSelect.value);
            const wakeUpTimeMinutes = timeStringToMinutes(wakeUpTimeInput.value);
            const userAwakeTimeMinutes = (parseInt(awakeTimeHoursInput.value) || 0) * 60 + (parseInt(awakeTimeMinutesInput.value) || 0);
            const napCount = parseInt(napCountSelect.value) || scheduleData[age].napCount;
            const nightSleepDurationMinutes = parseInt(nightSleepDurationSelect.value);

            // 입력 값 검증
            if (isNaN(age) || isNaN(wakeUpTimeMinutes) || isNaN(userAwakeTimeMinutes) || isNaN(nightSleepDurationMinutes)) {
                showError("모든 항목을 선택해주세요.");
                return;
            }

            const awakeTimeMinutes = userAwakeTimeMinutes || scheduleData[age].awakeTime;

            // 스케줄 생성
            const dailySchedule = [];
            let currentTimeMinutes = wakeUpTimeMinutes;
            let totalScheduleMinutes = 0;

            dailySchedule.push({ time: minutesToTimeString(currentTimeMinutes), activity: "기상" });

            for (let i = 0; i < napCount; i++) {
                const awakeTimeIncrease = getAwakeTimeIncrease(age);
                const awakeTimeForThisNapMinutes = awakeTimeMinutes + (i * awakeTimeIncrease);
                
                currentTimeMinutes += awakeTimeForThisNapMinutes;
                totalScheduleMinutes += awakeTimeForThisNapMinutes;

                dailySchedule.push({ time: minutesToTimeString(currentTimeMinutes), activity: `낮잠 ${i + 1} 시작` });

                const napDurationMinutes = getNapDuration(age, napCount, i);

                currentTimeMinutes += napDurationMinutes;
                totalScheduleMinutes += napDurationMinutes;

                dailySchedule.push({ time: minutesToTimeString(currentTimeMinutes), activity: `낮잠 ${i + 1} 종료` });
            }

            // 마지막 깨어있는 시간 추가
            const lastAwakeTimeMinutes = 1440 - totalScheduleMinutes - nightSleepDurationMinutes; // 1440 = 24시간
            if (lastAwakeTimeMinutes < 0) {
                showError("일정이 24시간을 초과합니다. 새로고침 후 입력 값을 조정해주세요.");
                return;
            }

            currentTimeMinutes += lastAwakeTimeMinutes;
            totalScheduleMinutes += lastAwakeTimeMinutes;

            // 밤잠 시작 시간 추가
            dailySchedule.push({ time: minutesToTimeString(currentTimeMinutes), activity: "밤잠" });

            // 테이블에 스케줄 표시
            scheduleTable.innerHTML = '';
            dailySchedule.forEach(item => {
                const row = scheduleTable.insertRow();
                row.insertCell(0).textContent = item.time;
                row.insertCell(1).textContent = item.activity;
            });
        }

        generateScheduleBtn.addEventListener('click', generateSchedule);

        // 나이 선택 시 평균 깨어있는 시간 자동 입력
        ageSelect.addEventListener('change', function() {
            const age = parseInt(this.value);
            if (scheduleData[age]) {
                const awakeTimeMinutes = scheduleData[age].awakeTime;
                const hours = Math.floor(awakeTimeMinutes / 60);
                const minutes = awakeTimeMinutes % 60;
                awakeTimeHoursInput.value = hours;
                awakeTimeMinutesInput.value = minutes;
            }
        });
      
        // 페이지 로드 시 기본값 설정
        window.addEventListener('load', function() {
            const wakeUpTimeInput = document.getElementById('wakeUpTime');
            wakeUpTimeInput.value = '07:00'; // 24시간 형식 사용
        });
    </script>
</body>
</html>
